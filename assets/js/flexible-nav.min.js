(function (e) {
    var b = 0;
    var c = function () {
        return ++b
    };
    var a = function (f) {
        var h = e('<nav class="flexible-nav"><ul></ul></nav>');
        var g = e.map(f, function (i) {
            return e('<li><a rows="'+ i.rows +'" line_num="'+ i.lineNum +'" href="' + i.href + '">' + i.text + "</a></li>")[0];
        });
				
        h.find("ul").append(g);				
        return h;
    };
    var d = function (g) {
        var f = e(g).attr("href");
        if (f.substring(0, 1) == "#") {
            var h = e(f);
            return h.size() ? h : null
        }
        return null
    };
    window.FlexibleNavMaker = function (f) {
        var g = this;				
        g.nodes = e(f);
        g.make = function () {
            var h = g.nodes.map(function () {
                var i = e(this);
                var k = i.attr("id");
                if (!k) {
                    while (!k) {
                        k = "n" + (c());
                        if (e("#" + k).size() > 0) {
                            k = null
                        }
                    }
                    i.attr("id", k)
                }
                var j = i.attr("data-navtext");
                var r = i.attr("data-navtext-rows");
                var ln = i.attr("line_number");								
                if (j == null || j == "" || j == undefined){
                  return null;
                }
								
                return {
                    href: "#" + k,
                    text: j,
                    rows: r,
                    lineNum: ln
                }
            });						
            return a(h);
        }
    };
    window.FlexibleNav = function (_container, g) {
        var f = this;
        f.nav = e(g);        
        f.update = function (_container) {
            var h = f.nav.find("a").map(function () {
                var m = e(this);
                var n = d(m);
                if (n == null || !n.is(":visible")) {
                    return null
                }
                return {
                    top: n.offset().top,
                    node: m
                }
            });
            e.each(h, function (m, n) {
              var rows = $(n.node).attr('rows');
              var line_num = $(n.node).attr('line_num');
              var k = $(_container).height();
              var lines = $(_container + " li").length;  
              var height_per_line = k/lines;
              var height = rows * height_per_line;
              var top = line_num * height_per_line;
              n.node.parent().css("margin-top", top + "px");
              //n.node.parent().css("height", height + "px");
            });            
            e.each(h, function (m, n) {
              n.node.removeClass("current");                
            });
        };
        f.update(_container)
    }
}(jQuery));